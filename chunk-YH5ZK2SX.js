import{C as a,db as m,f as h,jb as g,mc as n,z as l}from"./chunk-AZCM4A7V.js";var c=class s{constructor(t,e){this.http=t;this.Router=e}token="";isAuthenticated=!1;tokenTimer;userId="";authstatusListener=new h(!1);getauthStatusListener(){return this.authstatusListener.asObservable()}getIsAuth(){return this.isAuthenticated}createUser(t,e){let r={email:t,password:e};this.http.post(`${n.apiUrl}/user/signup`,r).subscribe({next:i=>{console.log(i),this.Router.navigate(["/"])},error:i=>{alert("Email already exists. Please try Login."),this.Router.navigate(["/login"])}})}Login(t,e){let r={email:t,password:e};this.http.post(`${n.apiUrl}/user/login`,r).subscribe(i=>{let o=i.token,u=i.expiresIn;if(o){this.token=o,this.isAuthenticated=!0,this.userId=i.userId,this.authstatusListener.next(!0),this.setLogoutTimer(u);let p=new Date(new Date().getTime()+u*1e3);this.saveAuthData(o,p,this.userId),this.Router.navigate(["/"])}},i=>{console.log(i)})}getuserid(){return this.userId}setLogoutTimer(t){this.tokenTimer=setTimeout(()=>{this.logout()},t*1e3)}saveAuthData(t,e,r){localStorage.setItem("token",t),localStorage.setItem("expiration",e.toISOString()),r&&localStorage.setItem("userId",r)}logout(){this.token="",this.isAuthenticated=!1,this.userId="",this.authstatusListener.next(!1),localStorage.removeItem("token"),localStorage.removeItem("expiration"),localStorage.removeItem("userId"),clearTimeout(this.tokenTimer),this.Router.navigate(["/"])}autoAuthUser(){let t=localStorage.getItem("token"),e=localStorage.getItem("expiration"),r=localStorage.getItem("userId");if(!t||!e)return;let i=new Date(e).getTime()-new Date().getTime();i>0?(this.isAuthenticated=!0,this.authstatusListener.next(!0),this.userId=r||"",this.setLogoutTimer(i/1e3)):this.logout()}static \u0275fac=function(e){return new(e||s)(a(m),a(g))};static \u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"})};export{c as a};
