import{d as z,e as H,f as J}from"./chunk-NEAULBVA.js";import{a as K,b as Q,c as W,d as X}from"./chunk-BJUCEGOC.js";import{$b as j,Aa as P,Ba as d,D as y,F as _,G as v,Ia as V,Lb as S,Ma as m,Mb as f,Ob as O,Pb as T,Sb as E,Tb as F,Ub as L,V as C,W as l,Xb as N,Yb as R,Zb as B,_b as G,ab as k,ba as w,d as x,ea as M,ec as q,fc as D,hb as A,i as b,ia as c,ic as U,ra as s,sa as o,ta as a,ua as p,ya as I}from"./chunk-7TZEPBTW.js";var Y=i=>{if(typeof i.value=="string")return b(null);let r=i.value,e=new FileReader;return new x(n=>{e.addEventListener("loadend",()=>{let t=new Uint8Array(e.result).subarray(0,4),u="",g=!1;for(let h=0;h<t.length;h++)console.log(t[h]),u+=t[h].toString(16);switch(u){case"89504e47":g=!0;break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":g=!0;break;default:g=!1;break}n.next(g?null:{invalidMimeType:!0}),n.complete()}),e.readAsArrayBuffer(r)})};function $(i,r){i&1&&p(0,"mat-spinner",3)}function ee(i,r){i&1&&(o(0,"mat-error"),m(1,"Title is required"),a())}function te(i,r){if(i&1&&(o(0,"div",15),p(1,"img",16),a()),i&2){let e=d(2);l(),s("src",e.imagePreview,C)("alt",e.form.value.title)}}function ie(i,r){i&1&&(o(0,"mat-error"),m(1,"Content is required"),a())}function re(i,r){if(i&1){let e=I();o(0,"mat-card",4)(1,"form",5),P("ngSubmit",function(){_(e);let t=d();return v(t.onsavepost())}),o(2,"mat-form-field",6)(3,"mat-label"),m(4,"Title"),a(),p(5,"input",7),c(6,ee,2,0,"mat-error",8),a(),o(7,"div",9)(8,"button",10),P("click",function(){_(e);let t=V(11);return v(t.click())}),m(9,"Pick Image"),a(),o(10,"input",11,0),P("change",function(t){_(e);let u=d();return v(u.onImagePicked(t))}),a()(),c(12,te,2,2,"div",12),o(13,"mat-form-field",6)(14,"mat-label"),m(15,"Content"),a(),p(16,"textarea",13),c(17,ie,2,0,"mat-error",8),a(),o(18,"button",14),m(19,"Save Post"),a()()()}if(i&2){let e,n,t=d();l(),s("formGroup",t.form),l(5),s("ngIf",(e=t.form.get("title"))==null?null:e.invalid),l(6),s("ngIf",t.imagePreview),l(5),s("ngIf",(n=t.form.get("content"))==null?null:n.invalid)}}var Z=class i{constructor(r){this.route=r}form;mode="create";postid=null;post;postsr=y(J);isLoading=!1;imagePreview=null;ngOnInit(){this.form=new N().group({title:["",[f.required,f.minLength(3)]],content:["",f.required],image:[null]}),this.route.paramMap.subscribe(r=>{r.has("postid")?(this.mode="edit",this.postid=r.get("postid"),this.isLoading=!0,this.postsr.getPost(this.postid).subscribe(e=>{this.isLoading=!1,this.post={id:e._id,title:e.title,content:e.content,imagePath:e.imagePath},this.form.patchValue({title:this.post.title,content:this.post.content,imagePath:this.post.imagePath}),console.log(this.post),this.imagePreview=this.post.imagePath}),this.form.get("image")?.clearValidators(),this.form.get("image")?.clearAsyncValidators(),this.form.get("image")?.updateValueAndValidity()):(this.mode="create",this.postid=null,this.form.get("image")?.setValidators([f.required]),this.form.get("image")?.setAsyncValidators([Y]),this.form.get("image")?.updateValueAndValidity())})}onsavepost(){if(this.form.invalid){this.form.markAllAsTouched();return}if(this.isLoading=!0,this.mode==="create"){let r={title:this.form.value.title,content:this.form.value.content,image:this.form.value.image};this.postsr.addPost(r)}else this.postsr.updatePost(this.postid,this.form.value.title,this.form.value.content,this.form.value.image)}onImagePicked(r){let e=r.target.files;if(!e||e.length===0)return;let n=e[0];this.form.patchValue({image:n}),this.form.get("image")?.updateValueAndValidity();let t=new FileReader;t.onload=()=>{this.imagePreview=t.result},t.readAsDataURL(n)}static \u0275fac=function(e){return new(e||i)(w(A))};static \u0275cmp=M({type:i,selectors:[["app-create-posts"]],decls:3,vars:2,consts:[["filepicker",""],["class","spinner",4,"ngIf"],["class","post-card",4,"ngIf"],[1,"spinner"],[1,"post-card"],[1,"post-form",3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","title"],[4,"ngIf"],[1,"image-pickker"],["mat-stroked-button","","type","button",3,"click"],["type","file","hidden","",3,"change"],["class","image-preview",4,"ngIf"],["matInput","","rows","6","formControlName","content"],["mat-raised-button","","color","primary","type","submit",1,"submit-btn"],[1,"image-preview"],[3,"src","alt"]],template:function(e,n){e&1&&(c(0,$,1,0,"mat-spinner",1)(1,re,20,4,"mat-card",2),p(2,"hr")),e&2&&(s("ngIf",n.isLoading),l(),s("ngIf",!n.isLoading))},dependencies:[R,E,S,O,T,X,W,U,q,D,Q,K,H,z,k,j,G,B,F,L],styles:[".post-card[_ngcontent-%COMP%]{max-width:600px;margin:20px auto;padding:20px}.post-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.full-width[_ngcontent-%COMP%]{width:100%}.image-picker[_ngcontent-%COMP%]{display:flex;gap:15px;align-items:center}.spinner[_ngcontent-%COMP%]{margin:40px auto;display:block}.submit-btn[_ngcontent-%COMP%]{width:150px;align-self:flex-end}.image-preview[_ngcontent-%COMP%]{width:100%;max-height:300px;object-fit:cover;margin-top:10px;border:1px solid #ccc;border-radius:4px;overflow:hidden;display:flex;justify-content:center;align-items:center}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain;display:block}"]})};export{Z as CreatePosts};
